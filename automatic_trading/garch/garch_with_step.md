# 加入分段式开仓后的GARCH模型回测

## 分段式做法

根据当前持有的 cashvega 以及该时刻得到的预测值的方向决定要做的目标cashvega仓位：

能做的cashvega仓位为**[-30000, -25000, -15000, 0, 15000, 25000, 30000]**, 

举例而言

- 当前cashvega为**-25000**，若预测值为**正向**，则cashvega调整为**-15000**
- 当前cashvega为**-25000**，若预测值为**负向**，则cashvega调整为**-30000**
- 当前cashvega为**-30000**，若预测方向为**负向**，则**不做操作**



### 加入调仓操作

若某时刻的cashvega绝对值低于开仓时要做的cashvega到一定程度，则进行调仓操作，即将仓位全部调到该时刻平值合约上；

#### 不调仓不分阶段vega

|          | 年化收益 | 最大回撤 |
| :------: | :------: | :------: |
| 次月合约 |  11.8%   |  5.45%   |



#### 分阶段vega，加入调仓操作，次月

| 当前cashvega < 开仓cashvega * x |              年化收益              | 最大回撤 |
| :-----------------------------: | :--------------------------------: | :------: |
|               0.5               |               8.48%                |  -8.8%   |
|               0.6               |               6.54%                |  -9.2%   |
|               0.7               |               6.77%                |  -9.1%   |
|               0.8               |               7.02%                |  -8.6%   |
|               0.9               |               8.35%                |  -8.4%   |
|             不调仓              | <font color='red'>**8.48%**</font> |  -8.8%   |

从结果看，不调仓的年化是最高的，收益回撤比最高的是按 0.9 调仓。



## 结果对比

**之前**回测的净值图（无调仓，无分阶段vega，次月）

![image-20221028093601257](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221028093601257.png)



**本次**回测的净值图（不调仓，分阶段vega，次月）

![image-20221028130550271](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221028130550271.png)



#### 第一次大回撤：2020.3.12~2020.3.25

![image-20221028133132813](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221028133132813.png)



大部分亏损来自于2020.3.16当天，该天没有满足条件的信号，仓位没变化；而前一天2020.3.13的13:15有一次正信号，cashvega仓位从-30000变为-25000，2020.3.13结束时的仓位是-25000，该较大的负vega仓位维持了数天，覆盖了方框中的一波大跌；

而上次回测中同一时段，是大幅盈利的，这是因为根据之前回测中的开仓设定，在2020.3.13的13:15 cashvega仓位直接变为+30000且2020.3.16全天持有该仓位；

所以对比来看，**之前回测中的此段盈利是不太合理的**。



#### 第二次大回撤：2022.3.4~2022.3.15

![image-20221028133444039](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221028133444039.png)



2022.3.4开始时就持有-30000cashvega，2022.3.7，3.8两天没信号，标的大跌，有大幅亏损，这一段亏损与上次回测是一致的，但上一次回测中经历了这次亏损后立刻赚了回去，原因仍旧在于在2022.3.14与2022.3.15有正信号，原来的回测直接将仓位变为+30000，而本次回测只是减仓，仍旧维持了至少-15000的cashvega，而标的仍旧有一波下跌，所以仍有大幅亏损；



#### 第三次大回撤：2022.4.22~2022.4.25

![image-20221028140336659](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221028140336659.png)



2022.4.22，2022.4.25两天都没有满足条件的信号，仓位没变，都是持有-30000cashvega，标的在2022.4.25有大跌，该段时间的大幅亏损与上次回测一致。



## 总结

加入了调仓并没有对回测结果有太大的提升；

分阶段式地调 vega 对回测结果影响比较大，与上次回测进行比较后，可以发现：

- 之前净值图中开始一部分的盈利不太合理；
- 新的净值图在大部分时间都比原来的更加平滑，且前大半段中是稳定盈利；
- 在回测时段末期中出现了两次较大的回撤，前一个回撤一部分是阶段式vega所导致的，后一个回撤则与上次回测一样，是由于该时段所有信号都被屏蔽导致在大跌期间持有错误的仓位；

可能的改进措施

- 对信号屏蔽的阈值也进行回测，因为之前的屏蔽条件（比如屏蔽 iv 值在全历史20和70分位值之间时的预测值）是尝试了几种情形后选取的，并没有尝试太多；例如可以考虑当前预测值与 iv 的分位值，如果是正的预测值，则 iv 分位值低于20时保留。











