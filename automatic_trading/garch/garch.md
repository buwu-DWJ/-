#                       GARCH模型回测

## 1. 策略回顾

- 510300期权，回测时间段2020.1.2~2022.7.11, 15分钟级
- 该段回测是后验型的，也就是该时间段的最后回测结果是根据各个GARCH模型的初始回测结果，筛选并剔除其中预测不好的结果后改进得到的

```python
# 先得到各个模型的单独回测结果
for 15种不同的GARCH模型:
    每个时刻历史20天的15分钟级调成后的对数收益率做GARCH拟合
    GARCH预测为正则做多vega,为负则做空vega,得到每个模型的回测净值曲线
# 选出效果最好的数个模型
for i=15,14,...7:
    在总的i个模型中计算(i-1)个模型的混合回测结果
    # 混合回测是通过各模型预测iv变化量和实际iv变化的相关性排序取最好的那个
    根据混合回测中Sharpe比率最高的一个组合,剔除剩余的一个模型
挑选到最后剩余6个模型

根据15个模型回测的统计结果，屏蔽掉每天中预测结果不好的时间段的预测结果
# 具体为:10:00~10:15, 11:00~11:15, 13:00~13:15, 13:45~14:00, 14:15~14:30
根据15个模型回测的统计结果，屏蔽掉预测值和iv该时刻相比上一时刻变化同向的情况
根据15个模型回测的统计结果，屏蔽掉对数收益率和iv该时刻相比上一时刻变化同向的情况
根据15个模型回测的统计结果，屏蔽掉当前iv超出阈值或当前预测值超出阈值的情况
# 具体为:iv在全部iv的20~70分位值内则跳过,预测值在全体预测值的40~60分位值内则跳过
根据15个模型回测的统计结果，屏蔽掉当前预测值与行情趋势相反的情况
# 具体为:连续4次实际iv同向变化情况下给出了反向的预测值

屏蔽上述情况后, 得到报告中的回测结果
```

#### 报告中的回测结果

每次做510300次月期权千3vega，总资产1,000,000，总收益为 539071.36 元; 一共调整仓位 617 次, 交易成本共计 64847.09元．扣除交易成本后, 在 569 个交易日约 2.33 年中实现收益率 **47.42%**, 年化收益率 **18.10%**,Sharpe比 2.263, 最大回撤 55328.61 元

![image-20221021094317606](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221021094317606.png)

## 2. 用实际期权回测

报告中回测与使用实际期权进行回测的一些不同之处

|                  | 报告中回测                                                   | 实际期权回测                                                 |
| ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 考虑时间段       | 包含了隔夜以及盘中，即在11:30以及15:00时如果有信号，则进行开仓并在13:00及下一日9:30时计算损益 | 不在11:30以及15:00两个时间点进行判断, 即11:15以及14:45的仓位会直接延续到13:00以及下一日9:30 |
| 期权价格         | 开盘与收盘使用的是9:30收盘价和15:00收盘价                    | 开盘收盘价格使用9:35和14:45收盘价                            |
| **损益计算方法** | 先计算每个时间点做千3vega对应的平值straddle的价格，每个时间段的损益是该时间段仓位乘以straddle的价格变化（并减去一定手续费） | 实际计算开仓时delta中性条件下千3vega所需的call和put各自的手数，每个时间段损益是该组合的实际价值变动 |

<font color='red'>**主要不同**：</font>报告中计算损益一直使用平值straddle，实际期权回测时持有的期权会因为**平值发生偏移**而价值可能发生大的变动

## 3. 回测结果

一千万资金，每次做千3vega，手续费2元/张，期末总资产12,732,661，年化11.8%，最大回撤5.45%

![image-20221021105857058](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221021105857058.png)

#### 三个特殊情况分析

- 2020.7.3 ,14:30判断开多仓，开仓前总资产**11,594,936**，买次月 4.4 处 call 和 put 各 200 和 229 手，价格分别为 0.1577 和 0.1414，2020.7.7  10:45平仓，平仓后总资产**12,101,441**，call和put价格分别为 0.4978 和 0.0663；

![image-20221021103104620](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221021103104620.png)

- 2021.7.22  14:45判断开空仓，开仓前总资产**12,808,515**，买次月 5.25 处 call 和 put 各 260 和 203 手，价格分别为 0.0830 和 0.1284 ，一直持仓到 2021.7.28 号到期日开盘时强制平仓，平仓时 call 和 put 价格分别为 0.0143 和0.4504，平仓后总资产为**12,331,623**；

![image-20221021104547960](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221021104547960.png)

- 2022.3.4  10:45判断开空仓，开空仓前总资产**12,874,318**，卖次月 4.5 处 call 和 put 各 197 和 233 手，价格分别为 0.1224 和 0.1009,  2022.3.9 14:00平仓，平仓时价格分别为 0.0306 和 0.4088，总资产变为**12,336,037**；

![image-20221021105554800](C:\Users\dingwenjie\AppData\Roaming\Typora\typora-user-images\image-20221021105554800.png)

## 4. 问题：如何调整回测方法以减少平移带来的影响

- 加入对冲操作；
- 加入换仓操作

## 5. 后续：使用样本外的数据进行回测

因为上述使用的各种屏蔽条件都是事后对回测结果进行统计而得到的，它们是否在2022.7.11后的新数据中仍旧有效需要进一步回测验证